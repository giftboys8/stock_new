# 股票分析系统 - 需求分析文档

## 项目概述

**项目名称**：个人股票分析系统
**项目目标**：开发一个基于AI的股票筛选和分析工具，支持漏斗型选股和深度个股分析
**投资理念**：长期投资，价值投资为主，集中投资（持有3-5只股票），分散风险（行业分散）
**创建日期**：2026-01-27
**最后更新**：2026-01-27 v1.3（固化用户选择和补充建议）

---

## 一、核心功能需求

### 1.1 漏斗型选股系统

从全市场5000+只股票中，通过三层筛选，选出10-20只优质股票。

#### **第1层：基础筛选（硬性门槛）**

**提供3套预设策略**：

**策略A：稳健型（适合熊市）**
| 指标 | 筛选条件 | 说明 |
|------|---------|------|
| 市值 | > 50亿 | 排除小盘股 |
| PE（市盈率） | 15 < PE < 30 | 合理估值 |
| ROE（净资产收益率） | > 20% | 优质公司 |
| 换手率 | 5% - 10% | 交易活跃 |
| 股价 | > 8元 | 避免低价股风险 |
| 日均成交额 | > 3000万 | 保证流动性 |

**策略B：平衡型（适合震荡市）⭐推荐**
| 指标 | 筛选条件 | 说明 |
|------|---------|------|
| 市值 | > 50亿 | 排除小盘股 |
| PE（市盈率） | 10 < PE < 40 | 适度放宽 |
| ROE（净资产收益率） | > 15% | 良好公司 |
| 换手率 | 3% - 15% | 活跃度范围扩大 |
| 股价 | > 8元 | 避免低价股风险 |
| 日均成交额 | > 3000万 | 保证流动性 |

**策略C：成长型（适合牛市）**
| 指标 | 筛选条件 | 说明 |
|------|---------|------|
| 市值 | > 30亿 | 允许中盘股 |
| PE（市盈率） | 0 < PE < 50 | 允许高成长股 |
| ROE（净资产收益率） | > 10% | 基本要求 |
| 换手率 | 3% - 20% | 活跃度范围更大 |
| 股价 | > 5元 | 降低股价门槛 |
| 日均成交额 | > 3000万 | 保证流动性 |

**预计筛选结果**：5000只 → 约80-200只（取决于选择的策略）

**术语解释**：
- **PE（市盈率）**：假设公司盈利不变，多少年能回本
- **ROE（净资产收益率）**：公司用股东的钱赚钱的能力
- **策略选择**：系统根据市场环境自动推荐，用户也可手动选择

---

#### **第2层：趋势筛选（刚启动的股票）**

| 指标 | 筛选条件 | 说明 | 可配置 |
|------|---------|------|--------|
| 百日均线 | 股价在MA100的±5%范围内 | 接近长期趋势线 | ✓ |
| 趋势方向 | MA20 > MA100 | 短期趋势向上，刚启动 | ✓ |
| 成交量 | 近5日平均成交量 > 前20日平均成交量 | 量能配合，有资金进入 | ✓ |
| 近20日涨幅 | > 0% | 短期表现良好 | ✓ |

**技术实现说明**：
- "刚启动趋势向上"：MA20（20日均线） > MA100（百日均线）
- 股价在MA100的±5%范围内：`0.95 * MA100 < 股价 < 1.05 * MA100`

**预计筛选结果**：100-200只 → 约30-50只

---

#### **第3层：基本面深度分析（AI辅助）**

| 维度 | 筛选条件 | 优先级 |
|------|---------|--------|
| 营收增长 | 近3年持续增长 | 硬性条件 |
| 净利润增长 | 近3年持续增长 | 硬性条件 |
| 行业地位 | 行业排名前五 | 硬性条件 |
| 机构持仓 | 基金/外资增持 | 参考（加分项，非硬性） |

**预计筛选结果**：30-50只 → 约10-20只优质股票

**注意**：机构持仓数据不是实时，季度更新，仅作参考

---

### 1.2 个股分析系统

#### **分析层次架构（三层模型）**

```
┌─────────────────────────────────────┐
│  第1层：宏观与事件层（决定投不投）    │
│  - 重大事件、政策、国际形势           │
│  - 如果这一层不过关，直接排除         │
│  🚦 红绿灯机制                       │
├─────────────────────────────────────┤
│  第2层：行业与基本面层（决定投多少）  │
│  - 行业景气度、赛道前景               │
│  - 公司财务质量                       │
│  - 这一层决定仓位大小                 │
│  ⚖️ 称重机制                         │
├─────────────────────────────────────┤
│  第3层：技术面层（决定何时买）        │
│  - 支撑位/压力位                      │
│  - 买入时机                           │
│  - 这一层决定买入价格                 │
│  🎯 找时机机制                       │
└─────────────────────────────────────┘
```

---

#### **详细分析维度**

##### **D. 宏观与事件层（最重要）**

| 子维度 | 具体内容 | 影响周期 | AI作用 |
|-------|---------|---------|--------|
| **公司重大事件** | 并购、分拆、大额订单、业绩预告 | 中长期（3-12个月） | ✓ 抓取、分析、评分 |
| **政策影响** | 行业监管、税收政策、补贴政策 | 长期（1-3年） | ✓ 判断影响程度 |
| **国际形势** | 美联储加息、地缘冲突、汇率变化 | 短期/中期（1-6个月） | ✓ 生成影响分析 |
| **行业动态** | 技术突破（如AI）、供需变化 | 中期（6-12个月） | ✓ 识别机会 |

**红绿灯机制**：
- 🟢 绿灯：无重大利空，有潜在利好 → 可以考虑
- 🟡 黄灯：有不确定性或潜在风险 → 观望
- 🔴 红灯：有重大利空（政策打压、财务造假等） → 直接排除

---

##### **C. 行业数据**

| 子维度 | 具体内容 | AI作用 |
|-------|---------|--------|
| **行业景气度** | 行业PE在历史分位（现在行业是便宜还是贵） | ✓ 数据计算 |
| **行业增长率** | 近3年行业营收增速 | ✓ 趋势分析 |
| **行业内排名** | 公司在行业的位置（市值/营收排名） | ✓ 同行对比 |
| **行业政策** | 最近1年有没有重大行业政策 | ✓ 政策梳理 |

**称重机制**：
- 优秀行业（朝阳行业）+ 优质公司 → 重仓
- 一般行业 + 优质公司 → 中等仓位
- 优秀行业 + 一般公司 → 轻仓
- 一般行业 + 一般公司 → 不投资

---

##### **B. 财务数据**

| 子维度 | 具体内容 | 判断标准 | AI作用 |
|-------|---------|---------|--------|
| **盈利能力** | ROE、毛利率、净利率 | 越高越好，且稳定 | ✓ 识别异常 |
| **成长性** | 营收增长率、净利润增长率 | >15%优秀 | ✓ 趋势判断 |
| **财务健康** | 资产负债率、现金流 | 负债率<60%，现金流为正 | ✓ 风险识别 |
| **估值水平** | PE、PB、PEG | 与历史和行业对比 | ✓ 评估合理性 |

**称重机制**：
- 财务健康度高（全A）+ 成长性好 → 重仓
- 财务健康度高 + 成长性一般 → 中等仓位
- 财务健康度一般 + 成长性好 → 轻仓

---

##### **A. 技术分析**

| 子维度 | 具体内容 | AI作用 |
|-------|---------|--------|
| **支撑位/压力位** | 前期高点、低点、均线位置 | ✓ 自动识别 |
| **趋势判断** | MA20、MA60、MA120多头排列 | ✓ 趋势分析 |
| **买卖信号** | MACD金叉/死叉、KDJ超买超卖 | ✓ 信号生成 |
| **成交量** | 价量配合情况 | ✓ 量价分析 |

**找时机机制**：
- 即使通过了第1、2层，也不要追高
- 等待回调到支撑位再买入
- 给出建议买入价格区间

---

##### **E. 情绪面（简化版）**

| 子维度 | 具体内容 | 权重 | 数据来源 |
|-------|---------|------|---------|
| **市场换手率** | 全市场换手率 | 50% | akshare |
| **北向资金净流入** | 日度净流入/流出 | 50% | akshare |

**综合评分**（0-10分）：
```
情绪面得分 = 换手率得分 × 0.5 + 北向资金得分 × 0.5

得分解读：
- 得分<3：极度悲观（往往是买入时机）
- 得分3-6：正常
- 得分>7：极度乐观（往往是卖出时机）
```

**趋势判断**（避免单日数据误导）：
- 不仅看今日数据，还要看**近5日/10日趋势**
- **示例**：
  ```
  今日北向资金净流入50亿，但近5日累计净流出100亿
  → 情绪面得分需要打折（反映真实趋势）

  今日换手率2%，近5日平均2.1%
  → 情绪面得分正常（趋势稳定）
  ```

**红绿灯机制**：
- 🟢 绿灯：情绪面得分3-7，正常市场
- 🟡 黄灯：情绪面得分2-3或7-8，情绪极端，谨慎
- 🔴 红灯：情绪面得分<2或>8，极度恐慌或狂热，观望为主

---

##### **F. 资金面（简化版）**

| 子维度 | 具体内容 | 权重 | 数据来源 |
|-------|---------|------|---------|
| **北向资金净流入** | 外资动向 | 70% | akshare |
| **主力资金净流入** | 大单净流入 | 30% | akshare |

**综合评分**（0-10分）：
```
资金面得分 = 北向资金得分 × 0.7 + 主力资金得分 × 0.3

得分解读：
- 得分>7：资金大幅流入（上涨动力强）
- 得分4-7：资金平衡
- 得分<4：资金大幅流出（下跌风险大）
```

**趋势判断**（避免单日数据误导）：
- 不仅看今日数据，还要看**近5日/10日累计流向**
- **示例**：
  ```
  今日北向资金净流入50亿
  但近5日累计净流入100亿，近10日累计净流入200亿
  → 资金面得分优秀（持续流入）

  今日北向资金净流入50亿
  但近5日累计净流出100亿
  → 资金面得分打折（单日反弹，趋势未变）
  ```

**红绿灯机制**：
- 🟢 绿灯：资金面得分>6，资金流入，支持买入
- 🟡 黄灯：资金面得分4-6，资金平衡，观望
- 🔴 红灯：资金面得分<4，资金流出，不买入

---

#### **推荐报告格式**

采用**渐进式报告**（简洁摘要 + 可展开的详细分析）：

**默认展示：简洁摘要**
```
贵州茅台（600519）分析报告
━━━━━━━━━━━━━━━━━━━━━
📊 综合评分：8.5/10
  • 宏观与事件：8/10（无重大利空，白酒消费回暖）
  • 行业数据：9/10（行业龙头，估值合理）
  • 财务数据：9/10（ROE 30%，现金流优秀）
  • 技术面：7/10（接近支撑位1650元）
  • 情绪面：6/10（市场情绪正常）
  • 资金面：7/10（北向资金净流入）

💡 建议操作：逢低买入
🎯 建议价格：1650-1700元
📦 建议仓位：25%（基于评分8.5分）
🎯 止盈价：1820元（+10%）、1950元（+20%）
🛑 止损价：1485元（-10%）
⚠️ 风险提示：经济下行可能导致消费降级

[查看详细分析 ↓]  ← 点击展开
```

**点击展开后：详细分析**
```
【宏观与事件分析】
近期无重大利空，受益于消费复苏...
...（详细分析，500-1000字）

【行业分析】
白酒行业PE处于历史30%分位，估值偏低...
...（详细数据图表）

【财务分析】
ROE连续5年>25%，现金流充沛...
...（财务数据表格）

【技术分析】
当前处于上升通道，支撑位1650元...
...（K线图说明）

【情绪面分析】
当前市场情绪正常（6/10），换手率2.1%，北向资金净流入20亿元
...（情绪数据说明）

【资金面分析】
资金面良好（7/10），北向资金连续3日净流入，主力资金今日净流入5亿元
...（资金流向数据）

【AI推荐理由】
综合考虑，建议在1650-1700元区间建仓...
...（详细推理过程）

【仓位建议】
基于综合评分8.5分，建议仓位25%
如果计划持有4只股票，配置建议：
- 茅台（8.5分）：25%
- 其他3只各25%：75%
- 总仓位：100%

【止盈止损计划】
- 第一止盈位：1820元（+10%），卖出20%
- 第二止盈位：1950元（+20%），再卖出30%
- 第三止盈位：2145元（+30%），再卖出30%
- 清仓位：2475元（+50%）
- 止损位：1485元（-10%），坚决清仓

[收起 ↑]
```

**设计说明**：
- 用户首先看到简洁的评分和操作建议（一目了然）
- 需要深入了解时，点击展开查看详细分析
- 详细分析包括：各维度的深度分析、数据图表、AI推理过程

---

### 1.3 仓位管理系统

#### **基于评分的仓位建议（针对集中投资者）**

**适用对象**：计划持有3-5只股票的投资者

| 综合评分 | 建议仓位 | 最多持有数量 | 理由 |
|---------|---------|-------------|------|
| 9-10分 | 25-30% | 3-4只 | 优质标的，可以重仓 |
| 7-8分 | 15-20% | 4-5只 | 良好标的，正常仓位 |
| 5-6分 | 5-10% | 5-6只 | 观望为主，轻仓试探 |
| <5分 | 0% | - | 不投资 |

**示例配置（100%资金）**：
```
配置1（激进，持有4只）：
- 9分股票：30% × 1只 = 30%
- 8分股票：25% × 2只 = 50%
- 7分股票：20% × 1只 = 20%
- 总计：100%

配置2（保守，持有3只+现金）：
- 9分股票：30% × 1只 = 30%
- 8分股票：25% × 2只 = 50%
- 现金：20%
- 总计：100%
```

**总仓位控制**：
- 牛市：总仓位80-100%（现金0-20%）
- 震荡市：总仓位50-70%（现金30-50%）
- 熊市：总仓位20-40%（现金60-80%）

**持仓数量限制**：
- **最少持有3只股票**（分散风险，防止赌博式投资）
- **最多持有6只股票**（管理精力有限）
- **推荐持有4-5只股票**（平衡风险和管理难度）

**行业集中度限制**：
- **单一行业不超过40%**（防止行业系统性风险）
- **相关行业不超过50%**（如医药+生物技术）
- **示例**：
  ```
  ✓ 合理配置：
  - 医药30% + 消费25% + 金融25% + 科技20%

  ✗ 不合理配置：
  - 医药30% + 生物25% + 医疗器械20% = 75%医药行业
  ```

**风险提示**：
- 单只股票30%仓位意味着：如果这只股票跌50%，总资产损失15%
- 9-10分的股票必须真正优质（DCBAEF六个维度都优秀）
- 建议单只股票不超过30%，防止单一股票风险过大
- **行业分散非常重要**：行业政策风险可能导致同行业股票集体暴跌

---

### 1.4 止盈止损策略

#### **止盈策略（分批止盈）**

**方案A：保守止盈（推荐）**

| 涨幅 | 卖出比例 | 累计卖出 | 剩余仓位 | 说明 |
|------|---------|---------|---------|------|
| 涨10% | 卖出20% | 20% | 80% | 回本+小额利润，降低持仓成本 |
| 涨20% | 再卖出30% | 50% | 50% | 达到目标收益，锁定大部分利润 |
| 涨30% | 再卖出30% | 80% | 20% | 超预期收益，只留"观察仓" |
| 涨50% | 全部卖出 | 100% | 0% | 全部卖出，落袋为安 |

**示例**：
```
以100元买入1000股（投入10万元）

涨到110元（+10%）：卖出200股 → 回款2.2万元，剩余8.8万元
涨到120元（+20%）：卖出300股 → 回款3.6万元，剩余4.8万元（已盈利）
涨到130元（+30%）：卖出300股 → 回款3.9万元，剩余1.3万元（全是利润）
涨到150元（+50%）：全部卖出 → 回款2万元

总收益：约3.7万元（37%收益率）
```

---

#### **止损策略（坚决止损）**

| 触发条件 | 操作 | 理由 |
|---------|------|------|
| 跌破支撑位-8% | 卖出50% | 止损一半，观察是否反弹 |
| 跌破成本价-10% | **坚决清仓** | 承认错误，保住大部分本金 |
| 重大利空（如财务造假、政策打压） | **立即清仓** | 不犹豫，第一时间离场 |
| 持有1年不涨 | 考虑调仓 | 时间成本，资金利用率低 |

**重要原则**：
- **止损 > 止盈**：止损是保命，止盈是防止贪婪
- 长期投资≠不止损：当基本面逻辑破坏时，必须止损
- 止损后不要立即买入同样股票：给自己时间反思

---

### 1.5 市场环境判断

#### **市场环境自动判断**

系统根据以下维度自动判断当前市场环境（牛市/震荡市/熊市）：

**判断维度**：

| 维度 | 权重 | 关键指标 | 数据来源 |
|------|------|---------|---------|
| **技术面** | 30% | 沪深300 MA20 vs MA60、近10日涨幅 | akshare |
| **估值面** | 30% | 全市场PE中位数在历史分位 | akshare |
| **情绪面** | 20% | 市场换手率、北向资金净流入 | akshare |
| **资金面** | 20% | 北向资金、主力资金净流入 | akshare |

**判断逻辑**：
```
市场综合得分 = 技术面得分×0.3 + 估值面得分×0.3 + 情绪面得分×0.2 + 资金面得分×0.2

得分>70分：牛市
得分40-70分：震荡市
得分<40分：熊市
```

**根据市场环境调整策略**：

| 市场类型 | 总仓位建议 | 推荐策略 | 侧重点 |
|---------|----------|---------|--------|
| **牛市（>70分）** | 80-100% | 策略C（成长型） | 成长股、进攻 |
| **震荡市（40-70分）** | 50-70% | 策略B（平衡型）⭐ | 均衡配置 |
| **熊市（<40分）** | 20-40% | 策略A（稳健型） | 现金为主、防守 |

**默认设置**：
- 系统上线初期，默认使用"震荡市"配置
- 系统运行1周后，根据实际数据自动判断市场环境
- 用户也可以手动选择市场环境

---

#### **市场环境变化提醒**

**检测周期设计**：

| 检测类型 | 检测频率 | 说明 |
|---------|---------|------|
| **实时监控** | 每个交易日 | 后台自动计算市场综合得分 |
| **日常检查** | 每个交易日收盘后（15:30） | 判断当日市场环境 |
| **趋势确认** | 连续3个交易日 | 确认市场环境真正变化（避免单日噪音） |
| **通知触发** | 环境变化确认后 | 向用户发送变化通知 |

**检测周期（已确认）**：

**✅ 采用方案A：每日检测+连续3天确认**

- 每个交易日收盘后（15:30）自动检测
- 如果连续3个交易日市场环境不同，则确认变化
- 确认后立即发送通知给用户
- **优点**：及时，不会错过重要变化；连续3天过滤噪音
- **技术实现**：后台定时任务，计算市场综合得分

---

**变化提醒内容**：

当市场环境发生变化时（如震荡市→熊市），系统会：

1. **发送通知**：
   ```
   📊 市场环境变化提醒

   当前环境：震荡市 → 熊市 ⚠️
   市场得分：68分 → 38分

   📉 建议调整：
   - 总仓位：50-70% → 20-40%
   - 策略调整：平衡型 → 稳健型
   - 建议操作：减仓，增加现金比例

   📅 检测日期：2026-01-27
   ```

2. **显示持仓建议**：
   - 当前持仓：医药30%、消费25%、金融25%、科技20%（总仓位80%）
   - 目标持仓：医药15%、消费10%、金融10%、现金65%（总仓位35%）
   - 调仓建议：卖出哪些股票、保留哪些股票

3. **变化原因说明**：
   ```
   变化原因：
   - 技术面：沪深300跌破MA20，进入下降趋势
   - 估值面：全市场PE上升，估值偏高
   - 情绪面：换手率下降，市场转冷
   - 资金面：北向资金连续流出
   ```

4. **历史变化记录**：
   - 记录每次市场环境变化
   - 用户可查看历史变化轨迹
   - 帮助用户理解市场周期

---

**用户可配置选项（已确认）**：

- **通知方式**：
  - [x] 系统内通知（MVP版本）
  - [ ] 邮件通知（后续版本）
  - [ ] 微信通知（后续版本）

- **通知频率**：
  - [x] 每次变化都通知（已确认）
  - [ ] 只通知重要变化
  - [ ] 每周汇总一次

- **调仓方式**：
  - [x] 系统只提供建议，用户手动操作（已确认）✅
  - [ ] 系统自动操作（需要授权，后续版本）

---

### 1.7 补充功能（用户确认）

#### **功能1：市场环境预测（预测功能）**

**内容**：
- 不仅判断当前是什么市
- 还预测未来1-2周可能变成什么市
- 基于当前得分变化趋势进行预测

**示例**：
```
当前环境：震荡市（得分58分）
未来趋势：↓ 向下
预测：可能在2周后进入熊市

建议：
- 提前降低仓位到50%
- 关注系统性风险
```

**实现方式**：
- 分析近7天、14天、30天的得分变化趋势
- 如果得分持续下降，预测可能转熊
- 如果得分持续上升，预测可能转牛

---

#### **功能2：市场温度计可视化**

**内容**：
- 显示市场综合得分的趋势图
- 显示近30天、60天、90天的得分变化
- 用颜色表示温度（冷/适中/热）

**示例**：
```
市场温度计（近30天）

100分 ● 🔴 过热
 80分 ●
 60分 ● ● ● 🟡 适中
 40分 ●
 20分 ● 🔵 过冷
  0分 ●

当前得分：58分（震荡市）
温度适中，适合正常投资
```

**可视化方式**：
- 折线图显示得分变化
- 颜色标注：冷（蓝）、适中（黄）、热（红）
- 支持切换不同时间范围（30天/60天/90天）

---

#### **功能3：极端情况预警**

**内容**：
- 当市场出现极端情况时，立即通知（不需要等3天）
- 单日或单周出现剧烈波动时触发

**触发条件**：
- 单日跌幅>5%
- 单周跌幅>10%
- 单日涨幅>7%（过度热情）
- 市场得分单日变化>20分

**示例**：
```
🚨 极端情况预警

今日市场大跌（-6.5%），触发极端情况预警

影响：
- 短期恐慌情绪蔓延
- 建议临时规避风险

建议操作：
1. 立即检查持仓
2. 考虑临时止损（如果亏损接近-8%）
3. 等待市场稳定（1-3天）
4. 不要急于抄底

📅 2026-01-27 15:30
```

**特点**：
- 极端情况**不需要等连续3天**
- 立即通知，确保用户及时看到
- 区别于常规市场环境变化

---

### 1.6 行业配置建议

虽然初步筛选全行业，但提供行业配置池供参考：

#### **核心配置池（稳健型）**
适合长期投资，行业前景好：

| 行业 | 龙头股举例 | 特点 |
|------|-----------|------|
| 消费（白酒、食品） | 茅台、五粮液、海天 | 抗跌，长期稳健 |
| 医药（创新药、医疗器械） | 恒瑞、迈瑞、药明康德 | 人口老龄化，长期增长 |
| 新能源（电池、光伏） | 宁德时代、隆基绿能 | 政策支持，但波动大 |
| 科技（半导体、AI） | 中芯国际、科大讯飞 | 成长性高，但风险大 |
| 金融（银行、保险） | 招商银行、中国平安 | 分红稳定，估值低 |

**建议配置**：70% 核心配置池

---

#### **进攻配置池（成长型）**
波动大，但潜在收益高：

| 行业 | 特点 |
|------|------|
| 军工 | 地缘紧张时表现好 |
| 有色金属 | 经济复苏时表现好 |
| 电力设备 | 新能源相关 |

**建议配置**：30% 进攻配置池

---

## 二、AI架构设计

### 2.1 AI任务分工

| 任务类型 | 难度 | AI模型 | 说明 |
|---------|------|--------|------|
| **新闻抓取** | 低 | 爬虫+规则 | 不需要AI |
| **新闻情感分析** | 中 | Deep Seek | 判断利好/利空 |
| **事件影响分析** | 高 | Deep Seek | 影响多大、持续多久 |
| **财务数据计算** | 低 | Python库 | 规则+公式 |
| **行业对比** | 中 | Deep Seek | 同行业对比评分 |
| **技术分析计算** | 低 | TA-Lib | 技术指标库 |
| **生成推荐报告** | 高 | Deep Seek | 生成简洁+详细报告 |

---

### 2.2 模型选型

#### **主模型：Deep Seek**

**用途**：
- 所有需要AI推理的任务
- 新闻情感分析
- 事件影响分析
- 行业对比
- 生成推荐报告

**选择理由**：
- 中文理解能力强
- 成本相对较低
- 用户已可用

---

#### **备选模型推荐**

由于无法使用Claude和GPT-4，推荐以下备选：

| 模型 | 用途 | 获取方式 |
|------|------|---------|
| **Deep Seek-V3** | 主力模型 | 官方API |
| **Deep Seek-Coder** | 代码生成、数据处理 | 官方API |
| **Qwen（通义千问）** | 备选推理模型 | 阿里云API |
| **GLM（智谱）** | 备选推理模型 | 智谱AI API |

**建议**：
- 主要使用Deep Seek
- 如果遇到问题，可以尝试Qwen或GLM作为备选

---

### 2.3 数据处理工具

#### **Python库推荐**

| 任务 | Python库 | 说明 |
|------|---------|------|
| **数据获取** | akshare, tushare | 免费A股数据 |
| **技术分析** | TA-Lib, mplfinance | 计算技术指标 |
| **数据处理** | pandas, numpy | 数据清洗和计算 |
| **可视化** | matplotlib, plotly | 生成图表 |
| **网页爬虫** | requests, BeautifulSoup4 | 抓取新闻数据 |
| **定时任务** | APScheduler | 定时更新数据 |

---

## 三、数据源规划

### 3.1 行情数据

| 数据源 | 类型 | 覆盖范围 | 建议使用 |
|-------|------|---------|---------|
| **akshare** | 免费 | A股全覆盖 | ✓ 主力 |
| **tushare** | 免费/付费 | A股全覆盖 | ✓ 备选 |
| **yfinance** | 免费 | 美股、港股 | 国际市场 |

**推荐**：主要使用akshare（免费、数据全、易用）

---

### 3.2 新闻/公告数据

| 数据源 | 类型 | 内容 | 获取方式 |
|-------|------|------|---------|
| **东方财富网** | 免费 | 公司公告、新闻 | 爬虫 |
| **财联社** | 免费 | 快讯、政策 | 爬虫/API |
| **巨潮资讯** | 免费 | 官方公告 | 爬虫 |
| **雪球** | 免费 | 投资者讨论 | 爬虫 |

**注意**：爬虫需遵守robots.txt和法律法规

---

### 3.3 财务数据

| 数据源 | 类型 | 内容 | 建议使用 |
|-------|------|------|---------|
| **akshare** | 免费 | 财报数据、财务指标 | ✓ 主力 |
| **tushare** | 免费/付费 | 详细财务数据 | ✓ 备选 |

---

## 四、系统功能清单

### 4.1 核心功能

- [x] 漏斗型选股（三层筛选）
  - [x] 3套预设策略（稳健/平衡/成长）
  - [x] 市场环境自动判断（牛市/震荡市/熊市）
- [x] 个股深度分析（DCBAEF六维度）
  - [x] D. 宏观与事件层
  - [x] C. 行业数据层
  - [x] B. 财务数据层
  - [x] A. 技术分析层
  - [x] E. 情绪面层（简化版+趋势判断）
  - [x] F. 资金面层（简化版+趋势判断）
- [x] AI推荐报告（简洁+详细）
  - [x] 综合评分（0-10分）
  - [x] 各维度评分
  - [x] 建议操作、价格、仓位
  - [x] 止盈止损价格
  - [x] 风险提示
- [x] 仓位管理系统
  - [x] 基于评分的仓位建议
  - [x] 总仓位控制（根据市场环境）
  - [x] 持仓数量限制（3-6只）
  - [x] 行业集中度限制（单一≤40%）
- [x] 止盈止损策略
  - [x] 分批止盈计划（10%/20%/30%/50%）
  - [x] 坚决止损策略（-10%）
  - [x] 止盈止损价格提醒
- [x] 市场环境监控与预警
  - [x] 市场环境自动判断（每日检测+连续3天确认）
  - [x] 市场环境变化提醒（每次变化通知）
  - [x] 市场环境预测（未来1-2周趋势）
  - [x] 极端情况预警（单日大跌立即通知）
  - [x] 市场温度计可视化（得分趋势图）
- [x] 红绿灯/称重/找时机机制
- [x] 行业配置建议

---

### 4.2 辅助功能

- [ ] 自选股管理
- [ ] 历史分析记录
- [ ] 数据定时更新
- [ ] 风险提示
- [x] 市场环境实时监控

---

### 4.3 MVP版本功能范围

**第一阶段（必须实现）**：
- 漏斗型选股（3套策略）
- 个股分析（DCBA六维度）
- 仓位管理（基于评分）
- 止盈止损（10%/20%/30%/50%）
- 市场环境判断（每日检测）
- 渐进式报告

**第二阶段（时间允许）**：
- 情绪面/资金面分析（E、F维度）
- 市场环境变化提醒
- 市场环境预测
- 极端情况预警

**第三阶段（后续优化）**：
- 市场温度计可视化
- 行业集中度检测
- 持仓数量监控
- 历史回测功能

---

## 五、非功能性需求

### 5.1 可配置性

- ✓ 所有筛选条件可配置
- ✓ 行业配置可调整
- ✓ 报告详细程度可切换

---

### 5.2 易用性

- 界面简洁直观
- 专业术语有解释
- 一键生成报告

---

### 5.3 数据时效性

| 数据类型 | 更新频率 | 说明 |
|---------|---------|------|
| 行情数据 | 实时/日级 | 盘中实时或盘后更新 |
| 财务数据 | 季度 | 季报更新后 |
| 新闻数据 | 实时 | 每小时抓取 |

---

## 六、约束条件

### 6.1 法律合规

- 不提供明确的买卖建议（仅提供分析参考）
- 不承诺收益
- 风险提示醒目

---

### 6.2 技术约束

- AI模型：主要使用Deep Seek
- 数据源：优先免费数据源
- 平台：Web应用（浏览器访问）

---

## 七、后续计划

- [ ] 完成原型设计（界面设计稿）
- [ ] 编写PRD文档（系统设计方案）
- [ ] 开发核心功能
- [ ] 自测和验证

---

## 八、变更记录

| 日期 | 版本 | 变更内容 | 变更人 |
|------|------|---------|--------|
| 2026-01-27 | v1.0 | 初始版本，记录需求和AI架构 | 用户 + Claude |
| 2026-01-27 | v1.1 | 根据专家建议和用户反馈优化：<br>1. 增加3套筛选策略（稳健/平衡/成长）<br>2. 增加仓位管理系统（针对集中投资者）<br>3. 增加止盈止损策略（10%/20%/30%/50%）<br>4. 增加市场环境自动判断（牛市/震荡市/熊市）<br>5. 增加E.情绪面和F.资金面分析维度<br>6. 更新报告格式（包含仓位、止盈止损建议） | User + Claude |
| 2026-01-27 | v1.2 | 根据专家P1建议优化：<br>1. **增加持仓数量限制**：最少3只，最多6只<br>2. **增加行业集中度限制**：单一行业≤40%<br>3. **增加市场环境变化提醒**：每日检测+连续3天确认<br>4. **增加情绪/资金面趋势判断**：5日/10日趋势 | User + Claude |
| 2026-01-27 | v1.3 | **固化用户选择和补充建议**：<br>1. **确认检测周期**：方案A（每日检测+连续3天确认）✅<br>2. **确认通知频率**：每次变化都通知✅<br>3. **确认调仓方式**：只提供建议，手动操作✅<br>4. **新增市场环境预测功能**（预测未来1-2周趋势）<br>5. **新增市场温度计可视化**（得分趋势图）<br>6. **新增极端情况预警**（单日大跌立即通知） | User + Claude |

---

**文档说明**：
- 本文档记录了项目的核心需求和设计决策
- 后续开发过程中，如需变更需求，请更新本文档并记录变更原因
- 所有开发工作应基于本文档进行
